<!DOCTYPE html>
<!--
    Copyright (c) 2015, SerGIS Project Contributors. All rights reserved.
    Use of this source code is governed by the MIT License, which can be found
    in the LICENSE.txt file.
-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SerGIS</title>
    <link rel="stylesheet" type="text/css" href="lib/style.css" data-set-attribute="href style.css">
    <!-- ESRI ArcGIS API stylesheet -->
    <link rel="stylesheet" type="text/css" href="http://js.arcgis.com/3.11/esri/css/esri.css">
</head>
<body>

<div id="main-wrapper" style="display: none;">
    <header class="noselect">
        <h1>SerGIS</h1>
        <div id="main-toolbox" class="toolbox">
            <ul id="main-toolbox-buttons" class="buttons"></ul>
            <span id="main-toolbox-status"></span>
        </div>
        <div class="account">Logged in as <span id="main-displayName"></span>.<br><button id="main-logout">Log Out</button></div>
    </header>
    
    <section id="map-container" class="with-sidebar">Loading map...</section>
    
    <aside id="sidebar" class="noselect">
        <h2 id="sidebar-title"><span id="sidebar-title-number" style="float: right;">#</span><span id="sidebar-title-text">title</span></h2>
        <div id="sidebar-content" class="content">Loading content...</div>
        <footer id="sidebar-footer">
            <div id="sidebar-footer-navigation" class="progress"><button id="navigation-previous" style="display: none;">Back</button><button id="navigation-next" style="display: none;">Skip</button>Page <span id="navigation-promptNumber"></span> of <span id="navigation-promptCount"></span></div>
            <div class="copyright">Copyright &copy; 2015, SerGIS Project Contributors. All Rights Reserved.</div>
        </footer>
    </aside>
    
    <aside id="sidebar-overlay" class="aside-overall noselect" style="display: none;">
        <table><tbody><tr><td>
            <div id="sidebar-overlay-content" style="display: none;"></div>
            <p id="sidebar-overlay-loading">Loading...</p>
        </td></tr></tbody></table>
    </aside>
    
    <div id="map-popup" class="popup" style="display: none;"></div>
    <div id="sidebar-resizer" class="resizer noselect"></div>
</div>

<div id="login-wrapper" style="display: none;">
    <header class="noselect">
        <h1>SerGIS</h1>
    </header>
    <section>
        <h2>Log In</h2>
        <form id="login-form"><fieldset>
            <p id="login-errmsg" class="errmsg" style="display: none;"></p>
            <table><tbody>
                <tr><td>Username:</td><td><input id="login-username"></td></tr>
                <tr><td>Password:</td><td><input id="login-password" type="password"></td></tr>
            </tbody></table>
            <p><input type="submit" value="Log In"></p>
        </fieldset></form>
    </section>
</div>

<div id="loading" class="overall">
    <table><tbody><tr><td>
        <!--[if lt IE 9]><p>Please upgrade to a <a href="http://whatbrowser.org/">modern browser</a>.</p><![endif]-->
        <!--[if gte IE 9]>-->
        <p id="loading-text"><noscript>Please enable JavaScript.</noscript></p>
        <!--<![endif]-->
    </td></tr></tbody></table>
</div>


<!--
  ************************
  ** External libraries **
  ************************
-->

<!-- socket.io API (if applicable) -->
<script type="text/javascript" data-set-attribute="src socket-io-script-src"></script>

<!-- ESRI ArcGIS API -->
<script type="text/javascript" src="http://js.arcgis.com/3.11/"></script>

<!-- YouTube API -->
<script type="text/javascript" src="https://www.youtube.com/player_api"></script>

<!--
  **********************
  ** SerGIS libraries **
  **********************
-->

<!-- ES6 Promise polyfill -->
<script type="text/javascript" src="lib/es6-promise-2.0.0.min.js" data-set-attribute="src es6-promise-2.0.0.min.js"></script>

<!-- SerGIS main library (must be first of our stuff) -->
<script type="text/javascript" src="lib/main.js" data-set-attribute="src main.js"></script>

<!-- SerGIS client frontend -->
<script type="text/javascript" src="lib/frontends/arcgis.js" data-set-attribute="src frontend-script-src"></script>

<!-- SerGIS client backend -->
<script id="sergis-backend-script" type="text/javascript" src="lib/backends/local.js" data-set-attribute="src backend-script-src; data-gameName gameName; data-socket-io-origin socket-io-origin; data-socket-io-prefix socket-io-prefix"></script>

<script data-set-if="test">
/*
Test function to test draw and buffer functionality.

   lat1 (number) - latitude of first end of line (default: 55)
   lng1 (number) - longitude of first end of line (default: 13)
   lat2 (number) - latitude of second end of line (default: 60)
   lng2 (number) - longitude of second end of line (default: 20)
   bufferDistance (number) - distance to buffer (default: 20)
   bufferUnits (string) - see SerGIS_ArcGIS~Unit in arcgis.js (default: miles)
   bufferStyle (object) - see SerGIS_ArcGIS~DrawStyle in arcgis.js
*/
function testDrawLineAndBuffer(lat1, lng1, lat2, lng2, bufferDistance, bufferUnits, bufferStyle) {
    sergis.frontend.actions.clearGraphics().then(
        function () {
            sergis.frontend.actions.draw(
                (lis = "o" + Math.random()),
                "line",
                {dotStyle: "square", lineStyle: "LongDash", lineWidth: 2},
                [{latitude: lat1 || 55, longitude: lng1 || 13}, {latitude: lat2 || 60, longitude: lng2 || 20}]
            ).then(
                function () {
                    sergis.frontend.actions.buffer(
                        bufferDistance || 20,
                        bufferUnits || "statute_mile",
                        lis,
                        bufferStyle
                    ).then(
                        console.log.bind(console, "Buffer Resolved"),
                        console.error.bind(console, "Buffer Rejected")
                    ).catch(sergis.error);
                },
                console.error.bind(console, "Draw Rejected")
            ).catch(sergis.error);
        },
        console.error.bind(console, "Clear Rejected")
    ).catch(sergis.error);
}


/*
Test function to test draw and buffer functionality.

   bufferDistance (number) - distance to buffer (default: 20)
   bufferUnits (string) - see SerGIS_ArcGIS~Unit in arcgis.js (default: miles)
   bufferStyle (object) - see SerGIS_ArcGIS~DrawStyle in arcgis.js
*/
function testDrawPolygonsAndBuffer(bufferDistance, bufferUnits, bufferStyle) {
    sergis.frontend.actions.clearGraphics().then(
        function () {
            sergis.frontend.actions.draw(
                (lis = "o" + Math.random()),
                "polygon",
                [
                    {
                        "latitude": 55.6,
                        "longitude": 12
                    },
                    {
                        "latitude": 57,
                        "longitude": 14
                    },
                    {
                        "latitude": 55.6,
                        "longitude": 15
                    }
                ],
                [
                    {
                        "latitude": 55,
                        "longitude": 12
                    },
                    {
                        "latitude": 54,
                        "longitude": 14
                    },
                    {
                        "latitude": 56,
                        "longitude": 14
                    }
                ]
            ).then(
                function () {
                    sergis.frontend.actions.buffer(
                        bufferDistance || 20,
                        bufferUnits || "statute_mile",
                        lis,
                        bufferStyle
                    ).then(
                        console.log.bind(console, "Buffer Resolved"),
                        console.error.bind(console, "Buffer Rejected")
                    ).catch(sergis.error);
                },
                console.error.bind(console, "Draw Rejected")
            ).catch(sergis.error);
        },
        console.error.bind(console, "Clear Rejected")
    ).catch(sergis.error);
}
</script>

</body>
</html>
